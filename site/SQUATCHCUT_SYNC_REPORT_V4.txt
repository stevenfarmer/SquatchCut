SQUATCHCUT_SYNC_REPORT_V4
Generated Thu Dec 11 18:35:54 UTC 2025 on branch reports/sync-v4. Overall project health is solid for core workflows (CSV → sheets → nesting → export) with strong unit coverage; remaining gaps are around preview determinism, sheet exhaustion feedback, UI overflow polish, and full Addon Manager readiness. Multi-sheet pipelines, exporter model, and measurement handling are present, but some workflows remain fragile. Docs are largely aligned after the v3.3 refresh, now AI-tool-agnostic. Distance to Addon Manager readiness: moderate—packaging exists, but preview lifecycle, UI polish, and a few tests/docs still need tightening.

SECTION: MODULE_INVENTORY
- CORE
  - freecad/SquatchCut/core/session.py – Mirrors session state into the FreeCAD document, manages document objects/groups, and coordinates lifecycle cleanup.
  - freecad/SquatchCut/core/session_state.py – In-memory job/session defaults, measurement system, sheet configs, and export flags consumed by UI and commands.
  - freecad/SquatchCut/core/nesting.py – Orchestrates nesting strategies, sheet normalization, utilization metrics, and multi-sheet handling.
  - freecad/SquatchCut/core/multi_sheet_optimizer.py – Distributes parts across multiple sheets before detailed placement.
  - freecad/SquatchCut/core/nesting_engine.py – Core packing primitives used by cut-friendly/material-oriented strategies.
  - freecad/SquatchCut/core/cut_optimization.py – Guillotine/cut-friendly optimizer leveraging free-rectangle style packing.
  - freecad/SquatchCut/core/units.py – Unit conversions and fractional-inch formatting helpers.
  - freecad/SquatchCut/core/text_helpers.py – Formatting helpers for display strings and labels.
  - freecad/SquatchCut/core/sheet_model.py – Builds/maintains sheet objects in FreeCAD, handles boundaries and naming.
  - freecad/SquatchCut/core/preferences.py – Preferences wrapper for defaults per measurement system.
  - freecad/SquatchCut/core/presets.py and sheet_presets.py – Provide preset metadata and factories for common sheet sizes.
  - freecad/SquatchCut/core/csv_loader.py and csv_import.py – Parse/validate CSV cut lists, enforce required headers, and normalize rows.
  - freecad/SquatchCut/core/shape_extractor.py – Extracts panel metadata from selected FreeCAD geometry with rotation flags.
  - freecad/SquatchCut/core/geometry_output.py – Builds FreeCAD geometry for sheets and nested parts from placements.
  - freecad/SquatchCut/core/geometry_sync.py – Keeps document groups in sync, clearing/rebuilding as needed.
  - freecad/SquatchCut/core/overlap_check.py – Utility for detecting overlapping placements.
  - freecad/SquatchCut/core/logger.py – Centralized logging with SquatchCut prefixes.
  - freecad/SquatchCut/core/exporter.py – Canonical ExportJob/ExportSheet/ExportPartPlacement model and CSV/SVG export helpers.
  - freecad/SquatchCut/core/cutlist.py – Generates cut operations and writes cutlists from session/nesting state.
  - freecad/SquatchCut/core/report_generator.py – Produces report artifacts from export data.
  - freecad/SquatchCut/core/gui_tests.py – Lightweight GUI smoke-test harness callable from the settings panel.
  - freecad/SquatchCut/core/view_controller.py – Controls source vs nested view visibility and zooming.
  - freecad/SquatchCut/core/units.py – Converts mm↔fractional inches and controls display units.
  - freecad/SquatchCut/core/session_state.py – Stores defaults, measurement system, and job metadata for hydration.
- GUI
  - freecad/SquatchCut/gui/taskpanel_main.py – Main TaskPanel controller; wiring for preview/apply, warning banner, and source/nesting controls.
  - freecad/SquatchCut/gui/taskpanel_input.py – CSV import UI wiring.
  - freecad/SquatchCut/gui/taskpanel_sheet.py – Sheet size/preset UI section.
  - freecad/SquatchCut/gui/taskpanel_nesting.py – Nesting options UI, including cut-friendly toggles and actions.
  - freecad/SquatchCut/gui/taskpanel_settings.py – Settings panel, hydration ordering, dev-mode/logging toggles, and GUI test launcher.
  - freecad/SquatchCut/gui/nesting_view.py – Draws/updates sheet and nested geometry in the 3D view.
  - freecad/SquatchCut/gui/source_view.py – Displays source parts and view helpers.
  - freecad/SquatchCut/gui/view_helpers.py and view_utils.py – Utility helpers for UI/view interactions.
  - freecad/SquatchCut/gui/dialog_preferences.py and dialogs/* – Dialog wrappers for commands/settings.
  - freecad/SquatchCut/gui/icons.py – Resolves icon resources.
  - freecad/SquatchCut/gui/qt_compat.py – Qt shim for tests/headless usage.
  - freecad/SquatchCut/freecad_integration.py – Integration glue for FreeCAD App/Gui availability and module setup.
- COMMANDS
  - freecad/SquatchCut/gui/commands/cmd_import_csv.py – Command to import CSV and seed session state.
  - freecad/SquatchCut/gui/commands/cmd_run_nesting.py – Runs nesting pipeline and routes to exporter for outputs.
  - freecad/SquatchCut/gui/commands/cmd_export_cutlist.py – Exports cutlists derived from current session/nesting state.
  - freecad/SquatchCut/gui/commands/cmd_export_report.py – Generates report artifacts.
  - freecad/SquatchCut/gui/commands/cmd_set_sheet_size.py – Sheet size dialog command.
  - freecad/SquatchCut/gui/commands/cmd_add_shapes.py – Adds shapes from selection.
  - freecad/SquatchCut/gui/commands/cmd_reset_view.py – Resets view orientation.
  - freecad/SquatchCut/gui/commands/cmd_preferences.py and cmd_settings.py – Open preference/settings panels.
  - freecad/SquatchCut/gui/commands/cmd_run_gui_tests.py – Invokes GUI test harness.
  - freecad/SquatchCut/gui/commands/cmd_main_ui.py – Entrypoint to open the main TaskPanel.
- TESTS
  - tests/test_units*.py and test_units_fractional_inches.py – Unit conversion and fractional-inch formatting coverage.
  - tests/test_csv_*.py – CSV parsing/validation unit tests.
  - tests/test_sheet_*.py and test_sheet_presets.py – Sheet model behavior and preset logic.
  - tests/test_nesting.py, test_nesting_validation.py, test_overlaps.py – Core nesting correctness and overlap checking.
  - tests/test_nesting_view*.py, test_view_controller.py, test_views.py – View/controller and geometry rendering behavior.
  - tests/test_settings_hydration.py, test_defaults*.py, test_hydration_rules.py – Hydration/order and default separation.
  - tests/test_gui_* and test_taskpanel_* – GUI wiring, layout, and TaskPanel lifecycle checks (qt_compat).
  - tests/test_exporter.py, test_exporter_svg.py, test_cutlist.py – ExportJob building and CSV/SVG/cutlist outputs.
  - tests/test_logger.py, test_logging_integration.py – Logging behavior.
  - tests/test_docs_backlog_structure.py – Ensures docs/backlog anchors and required items.
  - tests_integration/test_freecad_nesting.py, test_multi_sheet_nesting.py, test_taskpanel_workflow.py – Higher-level FreeCAD-aware workflows for nesting, multi-sheet behavior, and TaskPanel flows.
- DOCS
  - docs/Project_Guide_v3.3.md – Canonical architecture/process guide (AI-agnostic worker model, hydration rules, measurement rules, export architecture).
  - docs/Project_Guide_v3.2.md – Historical reference.
  - docs/Backlog.md – v3.3-aligned backlog with AI/HUMAN/MIXED tags and archived v3.2 backlog.
  - docs/TESTING.md – Testing guidance for core and FreeCAD-aware runs.
  - docs/Development_Environment.md – Devcontainer/local tooling and AI-assistant setup.
  - docs/architecture.md – Module responsibilities snapshot.
  - docs/codex_workflows.md – AI worker prompt templates (Codex-style).
  - docs/UAT_Checklist.md and docs/UAT_Prep_Instructions.md – UAT guidance.
  - mkdocs.yml – Site navigation (v3.3 + historical v3.2).
- CI / PACKAGING
  - .github/workflows/docs.yml – Docs site build/publish.
  - .github/workflows/tests.yml – Main test matrix.
  - .github/workflows/freecad-integration.yml – FreeCAD integration runs.
  - .github/workflows/ruff-autofix.yml – Ruff autofix automation.
  - Makefile – Dev/test convenience targets.
  - freecad/SquatchCut.egg-info/* and package.xml – Packaging metadata for pip/addon distribution.

SECTION: FEATURE_STATUS_BY_AREA
- CSV import & parsing – Status: IMPLEMENTED/STABLE. Evidence: csv_loader/csv_import enforce required headers and normalization; tests/test_csv_import_validation.py and test_csv_units.py cover unit handling.
- Sheet configuration & presets (metric/imperial) – Status: IMPLEMENTED/STABLE with safeguards. Evidence: preferences.py, sheet_presets.py, taskpanel_sheet.py; tests/test_sheet_presets.py, test_defaults_separation.py, test_settings_hydration.py ensure defaults per system and preset behavior.
- Multi-sheet job handling – Status: IMPLEMENTED/STABLE baseline. Evidence: nesting.py normalization, multi_sheet_optimizer.py; integration tests/test_multi_sheet_nesting.py and unit tests around sheet_index propagation. Missing: user-facing exhaustion feedback and utilization metrics (noted in backlog).
- Nesting engine (core placement & cut optimization) – Status: IMPLEMENTED/STABLE with known heuristics. Evidence: cut_optimization.py, nesting_engine.py, nesting.py; tests/test_nesting.py, test_cut_optimization.py, overlaps tests. Fragile around advanced exhaustion heuristics per backlog.
- Geometry output (sheet + parts, orientation/coloring) – Status: IMPLEMENTED/STABLE. Evidence: geometry_output.py, sheet_model.py, view_controller.py, nesting_view.py; tests/test_nesting_view.py, test_geometry_output-related suites, test_nesting_view_geometry.py.
- Task panels (input, sheet, nesting, settings) – Status: IMPLEMENTED/FRAGILE. Evidence: taskpanel_* modules; GUI/layout tests (test_taskpanel_layout.py, test_taskpanel_preview_apply.py). Fragility: preview vs apply share destructive path; overflow risk on narrow docks; warning banner lifecycle needs more coverage (backlog).
- Preferences and measurement-system defaults – Status: IMPLEMENTED/STABLE. Evidence: preferences.py, settings.hydrate_from_params(), defaults separation; tests/test_defaults_and_presets.py, test_settings_hydration.py, test_defaults_separation.py.
- Logging and developer-mode tools – Status: IMPLEMENTED/PARTIAL. Evidence: logger.py, settings dev-mode toggles, test_logging_integration.py; backlog notes further polish for discoverability/non-intrusive UX.
- Cutlist / report export – Status: IMPLEMENTED/PARTIAL. Evidence: exporter.py (ExportJob), cutlist.py, report_generator.py, cmd_export_cutlist.py; tests/test_exporter.py, test_exporter_svg.py, test_cutlist.py. Remaining gaps: CSV cutlist and DXF readiness polishing per backlog; command coverage may need more UAT.
- GUI test harness (core/gui_tests.py) – Status: IMPLEMENTED/PARTIAL. Evidence: callable from settings; limited coverage noted; relies on qt_compat shims.
- Integration tests – Status: IMPLEMENTED/PARTIAL. Evidence: tests_integration/* cover nesting/taskpanel workflows but may not exercise preview/apply divergence or sheet exhaustion edge cases.

SECTION: TEST_COVERAGE_SUMMARY
- CSV import/parsing: WELL-COVERED (unit suites).
- Units/measurement handling: WELL-COVERED (units and fractional-inch tests).
- Sheet presets/defaults and hydration: WELL-COVERED (defaults/separation/hydration tests).
- Nesting core/optimizer: PARTIALLY-COVERED (nesting, cut_optimization, overlap tests; some heuristics and exhaustion scenarios lightly covered).
- Geometry/view rendering: PARTIALLY-COVERED (nesting_view, geometry_sync, view_controller tests; integration tests augment).
- TaskPanels/UI: PARTIALLY-COVERED (layout/preview/apply/UI hydration tests; narrow-dock overflow and banner lifecycle need more).
- Export (CSV/SVG/cutlist/report): PARTIALLY-COVERED (exporter, SVG, cutlist tests; report generation and DXF deferred).
- Logging/dev-mode: LIGHTLY-COVERED (logger and integration smoke).
- Integration end-to-end: PARTIALLY-COVERED (multi-sheet and workflow tests; preview determinism, exhaustion, and warning banner transitions are gaps).
- Docs structure: WELL-COVERED by tests/test_docs_backlog_structure.py for required anchors.

SECTION: DOCS_AND_WORKFLOW_ALIGNMENT
- docs/Project_Guide_v3.3.md and docs/Backlog.md appear largely aligned with code: measurement rules, hydration order, ExportJob model, and AI-agnostic workflow are consistent. v3.2 retained for history.
- Docs promise non-destructive preview and UI overflow fixes as targets, not current behavior; code still shares preview/apply path and dense layouts, matching backlog gaps.
- AI worker references are now tool-agnostic (examples include Codex/Jules but not exclusive).
- Backlog captures pending work (preview determinism, overflow, exhaustion feedback, DXF deferred) consistent with code state.
- Testing guidance (docs/TESTING.md) matches current test layout; UAT docs reference v3.3 guide.

SECTION: ADDON_MANAGER_READINESS
- MUST HAVE
  - Harden preview/apply separation to avoid document mutation during preview; ensure cleanup of SquatchCut_* groups.
  - Resolve TaskPanel overflow/clipping on narrow docks; ensure warning banner doesn’t break layout.
  - Sheet exhaustion detection and user-visible feedback to avoid silent truncation.
  - Confirm packaging metadata (package.xml, egg-info) and Makefile produce correct addon ZIP; validate commands register reliably.
  - Ensure cutlist/export commands are deterministic and user-triggerable from UI (no stubs).
- SHOULD HAVE
  - Additional tests for warning banner lifecycle, preview vs apply flows, and multi-sheet exhaustion metrics.
  - UAT pass with current v3.3 docs; update samples for metric/imperial expected outputs.
  - Document clear install/run steps for Addon Manager users (README/MkDocs visibility).
  - CI stability for FreeCAD integration matrix; Ruff autofix workflow kept green.
- NICE TO HAVE
  - Utilization percentages and per-sheet stats after nesting.
  - Improved multi-sheet visualization polish (labels/ghost cleanup).
  - DXF export (deferred) once CSV/SVG pipelines are locked.
  - Enhanced logging/dev-mode discoverability without impacting normal UX.

SECTION: RECOMMENDED_BACKLOG_ITEMS
- HIGH PRIORITY
  - Implement non-destructive preview path with deterministic cleanup of SquatchCut groups.
  - Add warning/banner lifecycle tests and fixes for nesting-mode/unit/system/job-sheet changes.
  - Detect and surface sheet exhaustion (logs + UI), preventing silent truncation.
  - Reflow TaskPanel controls to prevent overflow at narrow widths; add UI smoke tests for ~300–350 px docks.
  - Verify packaging/addon ZIP generation and command registration for Addon Manager compliance.
- MEDIUM PRIORITY
  - Expand integration tests for preview→apply sequencing and multi-sheet exhaustion edge cases.
  - Add utilization metrics per sheet and basic exhaustion summary in logs/UI.
  - Strengthen cutlist/report export determinism and document formats; confirm command dialogs behave under both unit systems.
  - Refresh sample CSVs and UAT collateral with v3.3 behaviors (preview/apply flow, multi-sheet examples).
  - Improve dev-mode/logging toggles discoverability while keeping them non-intrusive.
- LOW PRIORITY / NICE TO HAVE
  - Multi-sheet visualization polish (labels, spacing, ghost-object prevention).
  - DXF export from ExportJob after CSV/SVG are finalized.
  - Additional AI-worker job card templates and lint/test preflight guidance for contributors.
