name: "FreeCAD Integration (manual)"

on:
  workflow_dispatch:
    inputs:
      run_freecad_tests:
        description: "Run FreeCADCmd integration tests (downloads FreeCAD AppImage)"
        required: false
        default: "true"

jobs:
  freecad-integration:
    if: ${{ github.event.inputs.run_freecad_tests != 'false' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.x"
      - name: Install pytest
        run: python -m pip install --upgrade pip pytest
      - name: Download FreeCAD AppImage
        run: |
          curl -L -o FreeCAD.AppImage https://github.com/FreeCAD/FreeCAD-Bundle/releases/download/0.21.2/FreeCAD_0.21.2-Linux-x86_64.AppImage
          chmod +x FreeCAD.AppImage
          ./FreeCAD.AppImage --appimage-extract
      - name: Run FreeCAD integration tests
        run: ./squashfs-root/AppRun -c "import run_freecad_tests"
